<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PDF to Custom Quality JPG (ZIP)</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(to right, #1f1c2c, #928dab);
    color: white;
    text-align: center;
    padding: 40px;
  }
  .container {
    background: rgba(255,255,255,0.1);
    padding: 25px;
    border-radius: 14px;
    max-width: 700px;
    margin: auto;
    box-shadow: 0 8px 20px rgba(0,0,0,0.5);
  }
  input, button, select {
    margin: 12px;
    padding: 12px 18px;
    border-radius: 8px;
    border: none;
    font-size: 15px;
  }
  button {
    background: #27ae60;
    color: white;
    cursor: pointer;
  }
  button:hover { background: #2ecc71; }
  .download-btn {
    display: none;
    margin: 15px auto;
    background: #ff9800;
    color: white;
    padding: 12px 22px;
    text-decoration: none;
    border-radius: 8px;
    font-weight: bold;
  }
  .download-btn:hover { background: #e68900; }
  canvas, img { margin:10px auto; max-width:100%; border:2px solid rgba(255,255,255,0.2); border-radius:8px; }
  label { display:block; margin-top:10px; font-size:14px; }
</style>
</head>
<body>
<div class="container">
  <h1>üìÑ PDF ‚Üí Custom Quality JPG (ZIP)</h1>
  <input type="file" id="pdfFile" accept="application/pdf">

  <!-- Scale control -->
  <label for="scaleRange">üîç Resolution Scale: <span id="scaleVal">5</span></label>
  <input type="range" id="scaleRange" min="3" max="12" step="1" value="5">

  <!-- Quality control -->
  <label for="qualitySelect">üñºÔ∏è JPEG Quality:</label>
  <select id="qualitySelect">
    <option value="1.0">1.0 (Maximum)</option>
    <option value="0.95">0.95 (Very High)</option>
    <option value="0.9">0.90 (High)</option>
    <option value="0.85">0.85 (Good)</option>
  </select>

  <br>
  <button onclick="convertPDF()">Convert</button>
  <a id="zipDownload" class="download-btn">‚¨áÔ∏è Download All (ZIP)</a>
  <div id="output"></div>
</div>

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<script>
// scale slider value ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
document.getElementById("scaleRange").addEventListener("input", function(){
  document.getElementById("scaleVal").innerText = this.value;
});

async function convertPDF() {
  const file = document.getElementById("pdfFile").files[0];
  if(!file){ alert("Upload PDF first!"); return; }

  const baseName = file.name.replace(/\.pdf$/i,"") || "converted";

  const scale = parseInt(document.getElementById("scaleRange").value); // custom scale
  const quality = parseFloat(document.getElementById("qualitySelect").value); // custom quality

  const reader = new FileReader();
  reader.onload = async function(e){
    const typedarray = new Uint8Array(e.target.result);
    const pdf = await pdfjsLib.getDocument(typedarray).promise;
    const outputDiv = document.getElementById("output");
    outputDiv.innerHTML = "";

    const zip = new JSZip();

    for(let i=1; i<=pdf.numPages; i++){
      const page = await pdf.getPage(i);
      const viewport = page.getViewport({scale: scale});

      const canvas = document.createElement("canvas");
      const context = canvas.getContext("2d");
      canvas.height = viewport.height;
      canvas.width = viewport.width;

      await page.render({canvasContext: context, viewport: viewport}).promise;

      // ‡¶õ‡ßã‡¶ü preview ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨ (medium quality ‡¶Ø‡¶æ‡¶§‡ßá browser hang ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá)
      const preview = document.createElement("img");
      preview.src = canvas.toDataURL("image/jpeg", 0.7);
      preview.style.maxWidth = "100%";
      outputDiv.appendChild(preview);

      // Convert canvas to JPG blob with chosen quality
      const blob = await new Promise(res => canvas.toBlob(res, "image/jpeg", quality));

      // Add to zip
      zip.file(`${baseName}_${i}.jpg`, blob);
    }

    // Generate ZIP
    const zipBlob = await zip.generateAsync({type:"blob"});
    const zipLink = document.getElementById("zipDownload");
    zipLink.href = URL.createObjectURL(zipBlob);
    zipLink.download = baseName + "_pages.zip";
    zipLink.style.display = "block";
  };
  reader.readAsArrayBuffer(file);
}
</script>
</body>
</html>
